/* Apagando uma Tabela */
DROP TABLE
	LOCACAO;


/* Criando uma Tabela */
CREATE TABLE LOCACAO (
	IDLOCACAO INT PRIMARY KEY,
	DATA TIMESTAMP,
	MIDIA INT,
	DIAS INT,
	ID_FILME INT,
	FOREIGN KEY (ID_FILME)
	REFERENCES FILME (IDFILME)
);


/* Criando uma Sequence */
CREATE SEQUENCE
	SEQ_LOCACAO;


NEXTVAL('SEQ_LOCACAO');


/* Inserindo Dados na Tabela */
INSERT INTO 
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/08/2018',
	23,
	3,
	100
);


INSERT INTO 
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/02/2018',
	56,
	1,
	400
);


INSERT INTO 
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'02/07/2018',
	23,
	3,
	400
);


INSERT INTO 
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'02/02/2018',
	43,
	1,
	500
);


INSERT INTO 
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'02/02/2018',
	23,
	2,
	100
);


INSERT INTO 
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'03/07/2018',
	76,
	3,
	700
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'03/02/2018',
	45,
	1,
	700
);


INSERT INTO
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'04/08/2018',
	89,
	3,
	100
);


INSERT INTO 
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'04/02/2018',
	23,

	3,800
);


INSERT INTO 
	LOCACAO
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'05/07/2018',
	23,
	3,
	500
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'05/02/2018',
	38,
	3,
	800
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/10/2018',
	56,
	1,
	100
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'06/12/2018',
	23,
	3,
	400
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/02/2018',
	56,
	2,
	300
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'04/10/2018',
	76,
	3,
	300
);



INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/09/2018',
	32,
	2,
	400
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'08/02/2018',
	89,
	3,
	100
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/02/2018',
	23,
	1,
	200
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'08/09/2018',
	45,
	3,
	300
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/12/2018',
	89,
	1,
	400
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'09/07/2018',
	23,
	3,
	1000
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/12/2018',
	21,
	3,
	1000
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/02/2018',
	34,
	2,
	100
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'09/08/2018',
	67,
	1,
	1000
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/02/2018',
	76,
	3,
	1000
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'01/02/2018',
	66,
	3,
	200
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'09/12/2018',
	90,
	1,
	400
);


INSERT INTO 
	LOCACAO 
VALUES(NEXTVAL(
	'SEQ_LOCACAO'),
	'03/02/2018',
	23,
	3,
	100
);


INSERT INTO 
	LOCACAO
VALUES(
	NEXTVAL('SEQ_LOCACAO'),
	'01/12/2018',
	65,
	5,
	1000
);


INSERT INTO 
	LOCACAO
VALUES(
	NEXTVAL('SEQ_LOCACAO'),
	'03/08/2018',
	43,
	1,
	1000
);


INSERT INTO 
	LOCACAO
VALUES(
	NEXTVAL('SEQ_LOCACAO'),
	'01/02/2018',
	27,
	31,
	200
);


/* Apagando uma Tabela */
DROP TABLE
	REL_LOCADORA;


/* Criando uma Tabela */
CREATE TABLE
	RELATORIO_LOCADORA
AS
	SELECT
		L.IDLOCACAO,
		F.NOME AS FILME,
		G.NOME AS GENERO,
		L.DATA AS DATA,
		L.DIAS AS DIAS,
		L.MIDIA AS MIDIA
	FROM
		GENERO G
	INNER JOIN
		FILME F
	ON
		G.IDGENERO = F.ID_GENERO
	INNER JOIN
		LOCACAO L
	ON
		L.ID_FILME = F.IDFILME;


/* Selecionando Registros Novos */
SELECT
	MAX(IDLOCACAO) AS RELATORIO,
	(SELECT
		MAX(IDLOCACAO)
	FROM
		LOCACAO) AS LOCACAO
FROM
	RELATORIO_LOCADORA;


SELECT
	L.IDLOCACAO,
	F.NOME AS FILME,
	G.NOME AS GENERO,
	L.DATA AS DATA,
	L.DIAS AS DIAS,
	L.MIDIA AS MIDIA
FROM
	GENERO G
INNER JOIN
	FILME F
ON
	G.IDGENERO = F.ID_GENERO
INNER JOIN
	LOCACAO L
ON
	L.ID_FILME = F.IDFILME
WHERE
	IDLOCACAO NOT IN (
		SELECT
			IDLOCACAO
		FROM
			RELATORIO_LOCADORA);


/* Inserindo Registros Novos */
INSERT INTO
	RELATORIO_LOCADORA
SELECT
	L.IDLOCACAO,
	F.NOME AS FILME,
	G.NOME AS GENERO,
	L.DATA AS DATA,
	L.DIAS AS DIAS,
	L.MIDIA AS MIDIA
FROM
	GENERO G
INNER JOIN
	FILME F
ON
	G.IDGENERO = F.ID_GENERO
INNER JOIN
	LOCACAO L
ON
	L.ID_FILME = F.IDFILME
WHERE
	IDLOCACAO NOT IN (
		SELECT
			IDLOCACAO
		FROM
			RELATORIO_LOCADORA);